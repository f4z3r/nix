namespaces:
  utils:
    commands:
      change-dir:
        command: cd {{ dir }}
        description: Change to subdirectory
        interactive: true
        tags:
        - cd
        parameters:
          dir:
            prompt: Directory
            exclusive: true
            choices_cmd: fd -td -c never .
  nix:
    commands:
      rebuild:
        command: sudo nixos-rebuild {{ type }} --impure --flake .#
        description: Rebuild nix setup
        interactive: true
        tags:
        - sudo
        parameters:
          type:
            default: switch
            prompt: How to rebuild
            exclusive: true
            choices:
            - switch
            - reboot
      clean-generations:
        command: nix-collect-garbage --delete-older-than {{ days }}d
        description: Delete old nix generations
        interactive: true
        parameters:
          days:
            default: 30
            prompt: Number of days to keep
  bookmarks:
    commands:
      github:
        command: brave "https://github.com/{{ user }}/{{ project }}"
        description: Open a GitHub project
        tags:
        - brave
        parameters:
          user:
            default: f4z3r
            prompt: Choose user
          project:
            prompt: Choose project
      nixos:
        command: brave "https://search.nixos.org/packages?channel={{ channel }}"
        description: Open NixOS packages and versions
        tags:
        - brave
        parameters:
          channel:
            default: unstable
            prompt: Choose channel
            choices:
            - unstable
            - "23.11"
      home-manager:
        command: brave "https://home-manager-options.extranix.com/?query=&release={{ release }}"
        description: Open Home-Manager options
        tags:
        - brave
        parameters:
          release:
            default: master
            prompt: Choose release
            choices:
            - master
            - "release-23.11"
      printer-admin:
        command: brave "localhost:631"
        description: Open CUPS management GUI
        tags:
        - brave
  docker:
    commands:
      prune-containers:
        command: docker container list -a | perl -lane 'print @F[0] if ($_ =~ /Exited/ and $_ !~ /k3d/)' | xargs -r docker rm
        description: Delete all exited containers
        tags:
        - local
        - clean
      prune-images:
        command: docker images | tail -n+2 | perl -lane 'print @F[2] if @F[1] =~ /<none>/' | xargs -r docker rmi
        description: Delete all container images missing a tag
        tags:
        - local
        - clean
  lua:
    commands:
      install-local:
        command: luarocks --local make --deps-mode {{ deps_mode }} {{ rockspec }}
        description: Install rock locally
        tags:
        - local
        - luarocks
        interactive: true
        parameters:
          deps_mode:
            default: none
            exclusive: true
            prompt: Install dependencies
            choices:
            - none
            - one
            - all
            - order
          rockspec:
            prompt: Rockspec
            choices_cmd: fd -tf -c never '.*.rockspec' .
      remove-local:
        command: luarocks --local remove {{ rock }}
        description: Remove local rock
        tags:
        - local
        - luarocks
        interactive: true
        parameters:
          rock:
            prompt: Rock
            exclusive: true
            choices_cmd: luarocks --local list | rg -e '^\w' | rg -v -F 'Rocks installed'
config:
  shell: zsh
